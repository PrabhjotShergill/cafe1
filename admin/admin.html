<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cafe QuickBite - Admin Dashboard</title>
  <link rel="stylesheet" href="../styles/styles.css" />
  <style>
    body {
      background: #f7f7f7;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
    }
    .admin-header {
      padding: 18px 40px;
      background: #fff;
      font-size: 2rem;
      font-weight: bold;
      border-bottom: 1px solid #e9e9e9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .admin-header .highlight {
      color: #8bc34a;
    }
    .dashboard-container {
      max-width: 1000px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 1px 16px rgba(80,80,80,0.07);
    }
    h2 {
      margin-bottom: 20px;
      font-weight: 600;
      color: #333;
    }
    .section {
      margin-bottom: 38px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 12px;
      text-align: left;
    }
    th {
      background: #f3fbe7;
      color: #79a144;
    }
    button {
      background: #8bc34a;
      border: none;
      color: white;
      padding: 9px 16px;
      font-weight: 600;
      cursor: pointer;
      border-radius: 7px;
      margin-top: 12px;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #689f38;
    }
    input, select {
      padding: 7px 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-weight: 600;
      color: #3b3b3b;
      width: 220px;
    }
    .form-inline {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 15px;
    }
    .danger {
      background: #c62828;
    }
  </style>
</head>
<body>
  <header class="admin-header">
    Cafe QuickBite <span class="highlight">Admin</span> Dashboard
  </header>

  <div class="dashboard-container">
    <div class="section">
      <h2>Manage Staff</h2>
      <form id="addStaffForm" class="form-inline">
        <input type="text" id="staffName" placeholder="Staff Name" required />
        <select id="staffRole" required>
          <option value="" disabled selected>Select Role</option>
          <option value="Cashier">Cashier</option>
          <option value="Kitchen">Kitchen</option>
          <option value="Waiter">Waiter</option>
          <option value="Inventory">Inventory</option>
          <option value="Manager">Manager</option>
          <option value="Admin">Admin</option>
        </select>
        <button type="submit">Add Staff</button>
      </form>

      <table id="staffTable">
        <thead>
          <tr><th>Name</th><th>Role</th><th>Change Role</th><th>Remove</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="section">
      <div class="section">
       <h2>Reports</h2>
        <label>Start Date: <input type="date" id="startDate" /></label>
       <label style="margin-left:20px;">End Date: <input type="date" id="endDate" /></label>
       <br><br>
        <button onclick="generateReport()">Generate Report</button>
       <p><strong>Total Sales:</strong> â‚¹<span id="salesTotal">0</span></p>
       <p><strong>Orders Processed:</strong> <span id="ordersCount">0</span></p>
       <p><strong>Unique Customers:</strong> <span id="customerCount">0</span></p>
       <p><strong>Last Updated:</strong> <span id="reportTime">-</span></p>
       <p id="reportMsg" style="margin-top:10px; color:green;"></p>
        </div>
    </div>
  </div>

  <script>
    const staffApi = 'http://localhost:3000/staff';
    const reportApi = 'http://localhost:3000/reports/1';
    const roles = ['Cashier', 'Kitchen', 'Waiter', 'Inventory', 'Manager', 'Admin'];
    let staff = [];

    async function fetchStaff() {
      const res = await fetch(staffApi);
      staff = await res.json();
      renderStaff();
    }

    function renderStaff() {
      const tbody = document.querySelector('#staffTable tbody');
      tbody.innerHTML = '';
      staff.forEach(s => {
        const tr = document.createElement('tr');
        const sel = document.createElement('select');
        sel.innerHTML = roles.map(r => `<option value="${r}" ${r === s.role ? 'selected' : ''}>${r}</option>`).join('');
        sel.onchange = () => changeRole(s.id, sel.value);

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.className = 'danger';
        removeBtn.onclick = () => removeStaff(s.id);

        tr.innerHTML = `<td>${s.name}</td><td>${s.role}</td><td></td><td></td>`;
        tr.children[2].appendChild(sel);
        tr.children[3].appendChild(removeBtn);
        tbody.appendChild(tr);
      });
    }

    async function addStaff(event) {
      event.preventDefault();
      const name = document.getElementById('staffName').value.trim();
      const role = document.getElementById('staffRole').value;
      if (!name || !role) return;

      await fetch(staffApi, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, role })
      });
      document.getElementById('addStaffForm').reset();
      fetchStaff();
    }

    async function changeRole(id, newRole) {
      await fetch(`${staffApi}/${id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: newRole })
      });
      fetchStaff();
    }

    async function removeStaff(id) {
      await fetch(`${staffApi}/${id}`, { method: 'DELETE' });
      fetchStaff();
    }

    async function loadReport() {
      const res = await fetch(reportApi);
      if (!res.ok) return;
      const report = await res.json();
      document.getElementById('salesTotal').innerText = report.sales;
      document.getElementById('ordersCount').innerText = report.orders;
      document.getElementById('reportTime').innerText = new Date(report.lastUpdated).toLocaleString();
    }
   const ordersApi = 'http://localhost:3000/orders';

async function generateReport() {
  const startInput = document.getElementById('startDate').value;
  const endInput = document.getElementById('endDate').value;

  if (!startInput || !endInput) {
    alert('Please select both start and end dates.');
    return;
  }

  const startDate = new Date(startInput);
  const endDate = new Date(endInput);
  endDate.setHours(23, 59, 59, 999); // include full end day

  const res = await fetch(ordersApi);
  const allOrders = await res.json();

  const filtered = allOrders.filter(order => {
    const orderTime = new Date(order.time);
    return orderTime >= startDate && orderTime <= endDate;
  });

  const totalSales = filtered.reduce((sum, o) => sum + o.total, 0);
  const uniqueCustomers = new Set(filtered.map(o => o.customerPhone));
  const timestamp = new Date().toISOString();

  document.getElementById('salesTotal').innerText = totalSales;
  document.getElementById('ordersCount').innerText = filtered.length;
  document.getElementById('customerCount').innerText = uniqueCustomers.size;
  document.getElementById('reportTime').innerText = new Date(timestamp).toLocaleString();
  document.getElementById('reportMsg').innerText = 'Report generated successfully!';
  setTimeout(() => document.getElementById('reportMsg').innerText = '', 9000);
}

    document.getElementById('addStaffForm').addEventListener('submit', addStaff);
    fetchStaff();
    loadReport();
  </script>
</body>
</html>